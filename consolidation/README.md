
# Vanir Security Patch Management System

## Overview
Vanir is a security patch management system designed to automate the processing of security vulnerabilities, download relevant patches, and apply them to kernel codebases. It streamlines the patch management workflow using three core components: report parsing, patch fetching, and patch application.

##  Core Components

### 1. vanir_report_parser.py
**Description:**  
Processes security vulnerability reports and extracts structured information about required patches, including patch URLs, commit hashes, and affected files/functions.

**Inputs:**  
- consolidation/reports/vanir_output.json: Raw Vanir security vulnerability report  

**Outputs:**  
- consolidation/reports/parsed_report.json: Structured JSON mapping patches to affected files and functions  

**Key Features:**  
- Extracts patch URLs from Googlesource and CodeLinaro  
- Identifies commit hashes from URLs  
- Maps patches to affected files and functions  
- Organizes data into a structured JSON format  

**Usage:**  
```bash
python vanir_report_parser.py
```

---

### 2. patch_fetcher.py
**Description:**  
Downloads patch files from code repositories using the structured report generated by the parser. Filters patches to include only relevant files and saves them for later application.

**Inputs:**  
- consolidation/reports/parsed_report.json: Structured patch information  

**Outputs:**  
- fetch_patch_output/diff_output/<commit_hash>.diff: Downloaded and filtered patch files  

**Key Features:**  
- Supports Googlesource and CodeLinaro repositories  
- Implements exponential backoff for API rate limiting  
- Filters patches to include only relevant files  
- Base64 decodes Googlesource patches  
- Provides detailed success/failure reporting  

**Usage:**  
```bash
python patch_fetcher.py
```

---

### 3. patch_adopter.py
**Description:**  
Applies downloaded patches to the kernel source code and generates detailed reports on application outcomes using the GNU patch utility.

**Inputs:**  
- consolidation/reports/parsed_report.json: Structured patch information  
- fetch_patch_output/diff_output/<commit_hash>.diff: Downloaded patch files  
- Kernel source code directory (specified via KERNEL_PATH)  

**Outputs:**  
- consolidation/reports/patch_application_report.json: Detailed patch application report  

**Key Features:**  
- Applies patches using GNU patch  
- Detects application scenarios (clean apply, offsets, already applied, failures)  
- Identifies failed hunks and generates .rej rejection files  
- Maps failed files to corresponding rejection files  
- Provides comprehensive status reporting and summary statistics  

**Usage:**  
```bash
python patch_adopter.py
```

---

##  Complete Workflow

1. Parse the Vanir security report:  
   ```bash
   python vanir_report_parser.py
   ```

2. Download the necessary patches:  
   ```bash
   python patch_fetcher.py
   ```

3. Apply patches to the kernel source:  
   ```bash
   python patch_adopter.py
   ```

---

##  Directory Structure

```
consolidation/
├── reports/                # Contains input and output JSON files
└── *.py                    # Core script components

fetch_patch_output/
└── diff_output/            # Downloaded patch files
```

---

##  Environment Variables

- KERNEL_PATH: Path to the kernel source code (default: /data/androidOS14)

---

##  Dependencies

- Python 3.6+  
- GNU patch utility  
- Network access to Googlesource and CodeLinaro repositories  
